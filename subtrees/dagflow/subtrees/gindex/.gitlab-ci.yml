stages:
    - tests

tests:
    image: git.jinr.ru:5005/gna/gna-base-docker-image:gparser
    stage: tests

    script:
    - export PYTHONPATH="$PYTHONPATH:/builds/gna:/builds/gna/gassembler:/builds/gna/gassembler/src"
    - python3 -m pip install -r requirements.txt
    - coverage run --source=gindex -m pytest
    - coverage report
    - coverage xml
    coverage: '/(?i)total.*? (100(?:\.0+)?\%|[1-9]?\d(?:\.\d+)?\%)$/'
    artifacts:
        reports:
            coverage_report:
                coverage_format: cobertura
                path: coverage.xml
    only:
        - main
        - merge_requests
